(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();class c{constructor(){this.isOpen=!1,this.state="INIT",this.leadData={},this.knowledgeBase=[],this.elements={},this.init()}init(){this.buildKnowledgeBase(),this.createDOM(),this.attachEvents(),setTimeout(()=>{this.state==="INIT"&&(this.addBotMessage("Hi! ðŸ‘‹ Welcome to Pioneer Concrete Coatings."),setTimeout(()=>{this.addBotMessage("I can help you get a free quote or answer your questions. First, what's your name?"),this.state="ASK_NAME"},800))},1e3)}buildKnowledgeBase(){try{document.querySelectorAll("#faq .faq-item").forEach(e=>{var t,o;const s=((t=e.querySelector(".question span"))==null?void 0:t.innerText)||"",i=((o=e.querySelector(".answer"))==null?void 0:o.innerText)||"";s&&i&&this.knowledgeBase.push({type:"faq",q:s,a:i,tokens:this.tokenize(s+" "+i)})}),document.querySelectorAll("#services h2").forEach(e=>{const s=e.innerText,t=e.parentElement.innerText;s&&t&&this.knowledgeBase.push({type:"service",q:s,a:t.substring(0,300)+"...",tokens:this.tokenize(s+" "+t)})}),console.log(`Chatbot KB built with ${this.knowledgeBase.length} entries.`)}catch(e){console.warn("Chatbot KB build error",e)}}tokenize(e){return e.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(s=>s.length>2)}createDOM(){const e=document.createElement("div");e.id="pioneer-chatbot",e.innerHTML=`
            <div class="cb-fab" id="cb-fab">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                </svg>
            </div>
            <div class="cb-window" id="cb-window">
                <div class="cb-header">
                    <span class="cb-title">Support & Quotes</span>
                    <button class="cb-close" id="cb-close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="cb-messages" id="cb-messages"></div>
                <form class="cb-input-area" id="cb-form">
                    <input type="text" class="cb-input" id="cb-input" placeholder="Type your message..." autocomplete="off">
                    <button type="submit" class="cb-send" id="cb-send">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </form>
            </div>
        `,document.body.appendChild(e),this.elements.fab=document.getElementById("cb-fab"),this.elements.window=document.getElementById("cb-window"),this.elements.close=document.getElementById("cb-close"),this.elements.messages=document.getElementById("cb-messages"),this.elements.form=document.getElementById("cb-form"),this.elements.input=document.getElementById("cb-input")}attachEvents(){this.elements.fab.addEventListener("click",()=>this.toggleWindow()),this.elements.close.addEventListener("click",()=>this.toggleWindow()),this.elements.form.addEventListener("submit",e=>{e.preventDefault(),this.handleInput()})}toggleWindow(){this.isOpen=!this.isOpen,this.elements.window.classList.toggle("open",this.isOpen),this.isOpen&&this.elements.input.focus()}addBotMessage(e){const s=document.createElement("div");s.className="cb-msg bot",s.innerHTML=e,this.elements.messages.appendChild(s),this.scrollToBottom()}addUserMessage(e){const s=document.createElement("div");s.className="cb-msg user",s.textContent=e,this.elements.messages.appendChild(s),this.scrollToBottom()}scrollToBottom(){this.elements.messages.scrollTop=this.elements.messages.scrollHeight}handleInput(){const e=this.elements.input.value.trim();e&&(this.addUserMessage(e),this.elements.input.value="",setTimeout(()=>this.processState(e),400))}processState(e){switch(this.state){case"ASK_NAME":this.leadData.name=e,this.addBotMessage(`Nice to meet you, ${e}. What is your email address?`),this.state="ASK_EMAIL";break;case"ASK_EMAIL":e.includes("@")?(this.leadData.email=e,this.addBotMessage("Got it. And what is your phone number?"),this.state="ASK_PHONE"):this.addBotMessage("That doesn't look like a valid email. Please try again.");break;case"ASK_PHONE":this.leadData.phone=e,this.addBotMessage("Thanks. Lastly, what type of coating project are you interested in? (e.g. Garage, Basement, Patio)"),this.state="ASK_TYPE";break;case"ASK_TYPE":this.leadData.projectType=e,this.submitLead(),this.addBotMessage("Perfect! I've sent your info to our team. We'll be in touch shortly."),setTimeout(()=>{this.addBotMessage("In the meantime, feel free to ask me any questions about our services, process, or pricing!"),this.state="QA_MODE"},1e3);break;case"QA_MODE":this.handleQA(e);break;default:this.addBotMessage("Not sure what happened there. Let's start over."),this.state="INIT"}}submitLead(){console.log("Lead Captured:",this.leadData);try{const e=new FormData;e.append("name",this.leadData.name),e.append("email",this.leadData.email),e.append("_replyto",this.leadData.email),e.append("_subject","New Lead from Chatbot"),e.append("phone",this.leadData.phone),e.append("message",`[Bot Capture] Project Type: ${this.leadData.projectType}`),fetch("https://formspree.io/f/mrezynqq",{method:"POST",body:e,headers:{Accept:"application/json"}}).catch(s=>console.error("Silent submission failed",s))}catch{}}handleQA(e){const s=this.tokenize(e);let i=null,t=0;for(const o of this.knowledgeBase){let n=0;s.forEach(l=>{o.tokens.includes(l)&&n++}),n>t&&(t=n,i=o)}i&&t>0?(this.addBotMessage(i.a),Math.random()>.7&&setTimeout(()=>this.addBotMessage("Any other questions?"),1e3)):this.addBotMessage("I'm not exactly sure about that one. You can call us at (413) 544-4933 or check our FAQ section below!")}}function h(){const a=document.getElementById("quote-form");if(!a)return;const e=document.getElementById("quote-form-status");a.addEventListener("submit",async s=>{s.preventDefault();const i=a.querySelector('button[type="submit"]'),t=i.innerText;i.disabled=!0,i.innerText="Sending...",e&&(e.classList.add("hidden"),e.innerText="",e.className="text-sm mt-2 hidden");const o=new FormData(a),n=Object.fromEntries(o.entries()),l={name:n.name,email:n.email,phone:n.phone,address:n.address,square_footage:n.square_footage,project_type:n.project_type,floor_condition:n.floor_condition,desired_finish:n.desired_finish,project_timeline:n.project_timeline,notes:n.message};try{try{await fetch("http://localhost:3000/api/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),console.log("Lead sent to CRM")}catch(d){console.error("Failed to send to CRM:",d)}const r=await fetch(a.action,{method:a.method,body:o,headers:{Accept:"application/json"}});if(r.ok)e&&(e.innerText="Thanks! We'll be in touch shortly.",e.classList.remove("hidden"),e.classList.add("text-green-500")),a.reset();else{const d=await r.json();e&&(e.innerText=d.error||"Oops! There was a problem submitting your form",e.classList.remove("hidden"),e.classList.add("text-red-500"))}}catch(r){console.error("Submission error:",r),e&&(e.innerText="Oops! There was a problem submitting your form",e.classList.remove("hidden"),e.classList.add("text-red-500"))}finally{i.disabled=!1,i.innerText=t}})}window.addEventListener("DOMContentLoaded",()=>{new c,h()});
